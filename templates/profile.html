{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width:500px; margin:auto;">
  <div class="text-center mb-4">
    <img src="{{ user.avatar if user.avatar else (user.gender == 'female' and '/static/default_avatar_female.jpg' or '/static/default_avatar_male.jpg') }}" class="rounded-circle border" width="120" height="120" style="object-fit:cover; border:3px solid #2575fc;">
    <h2 class="mt-3" style="font-weight:700; color:#2575fc;">{{ user.username }}</h2>
    <span class="badge bg-secondary">{{ user.gender|capitalize }}</span>
  </div>
  <form method="POST" enctype="multipart/form-data" class="card p-4 shadow-sm mb-4">
    <div class="mb-3">
      <label class="form-label">Username</label>
      <input type="text" class="form-control" name="username" value="{{ user.username }}">
    </div>
    <div class="mb-3">
      <label class="form-label">Gender</label>
      <select class="form-select" name="gender">
        <option value="male" {% if user.gender == 'male' %}selected{% endif %}>Male</option>
        <option value="female" {% if user.gender == 'female' %}selected{% endif %}>Female</option>
        <option value="other" {% if user.gender == 'other' %}selected{% endif %}>Other</option>
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Avatar</label>
      <input type="file" class="form-control" name="avatar">
    </div>
    <button type="submit" class="btn btn-primary w-100">Update Profile</button>
  </form>
  <div class="card p-4 shadow-sm mb-4">
    <h3 class="mb-3">Change Password</h3>
    <form method="POST" action="{{ url_for('update_password') }}">
      <div class="mb-3">
        <label class="form-label">Old Password</label>
        <input type="password" class="form-control" name="old_password">
      </div>
      <div class="mb-3">
        <label class="form-label">New Password</label>
        <input type="password" class="form-control" name="new_password">
      </div>
      <button type="submit" class="btn btn-warning w-100">Change Password</button>
    </form>
  </div>
  {% if friend_requests %}
  <div class="card p-4 shadow-sm mb-4">
    <h4 class="mb-3">Pending Friend Requests</h4>
    <ul class="list-group">
      {% for req in friend_requests %}
      <li class="list-group-item d-flex align-items-center justify-content-between">
        <span><b>{{ req.from_username }}</b></span>
        <form method="POST" action="/friend_request/accept/{{ req._id|string }}" style="display:inline;">
          <button type="submit" class="btn btn-success btn-sm">Accept</button>
        </form>
        <form method="POST" action="/friend_request/decline/{{ req._id|string }}" style="display:inline;">
          <button type="submit" class="btn btn-danger btn-sm">Decline</button>
        </form>
      </li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}
</div>
{% endblock %}
